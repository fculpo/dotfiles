---
- hosts: localhost
  vars:
    ansible_python_interpreter: /usr/bin/python3
    pip_package: python3-pip
  roles:
    - geerlingguy.pip
  tasks:

    - name: Ensure Aptitude is installed
      apt: name=aptitude state=present update_cache=yes
      become: yes

    - name: Update all packages
      apt:  name=* state=latest
      become: yes

    - name: Install prerequisites
      apt: name={{ item }} state=present
      become: yes
      with_items:
        - libdbus-1-dev
        - libx11-dev
        - libxinerama-dev
        - libxrandr-dev
        - libxss-dev
        - libglib2.0-dev
        - libpango1.0-dev
        - libgtk-3-dev
        - libxdg-basedir-dev
        - libxcb1-dev
        - libxcb-keysyms1-dev
        - libpango1.0-dev
        - libxcb-util0-dev
        - libxcb-icccm4-dev
        - libyajl-dev
        - libstartup-notification0-dev
        - libxcb-randr0-dev
        - libev-dev
        - libxcb-cursor-dev
        - libxcb-xinerama0-dev
        - libxcb-xkb-dev
        - libxkbcommon-dev
        - libxkbcommon-x11-dev
        - autoconf
        - libxcb-xrm0
        - libxcb-xrm-dev
        - automake

    - name: Install Hack font
      apt: name=fonts-hack-ttf state=present
      become: yes

    - name: Install i3-gaps
      block:
        - name: Download i3-gaps
          git:
            repo: 'https://www.github.com/Airblader/i3'
            dest: ~/wd/desktop/i3-gaps

        - name: Autoreconf
          command: autoreconf --force --install && rm -rf build/ && mkdir -p build
          args:
            chdir: ~/wd/desktop/i3-gaps
            creates: ~/wd/desktop/i3-gaps/build
        
        - name: configure
          command: ./configure --prefix=/usr --sysconfdir=/etc --disable-sanitizers
          args:
            chdir: ~/wd/desktop/i3-gaps
        
        - make:
            chdir: ~/wd/desktop/i3-gaps
    
        - make:
            chdir: ~/wd/desktop/i3-gaps
            target: install
          become: yes

    - name: Install dunst
      block:
        - git:
            repo: 'https://github.com/dunst-project/dunst.git'
            dest: ~/wd/desktop/dunst
        - make:
            chdir: ~/wd/desktop/dunst
        - make:
            chdir: ~/wd/desktop/dunst
            target: install
          become: yes